<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Money Tracker Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fdfdfd;
      --accent: #6366f1;
      --accent-light: #e0e7ff;
      --success: #059669;
      --danger: #dc2626;
      --warning: #f59e0b;
      --purple: #8b5cf6;
      --text-main: #1e293b;
      --text-muted: #64748b;
      --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.04), 0 8px 10px -6px rgba(0, 0, 0, 0.04);
      --glass: rgba(255, 255, 255, 0.8);
    }

    * { -webkit-tap-highlight-color: transparent; outline: none; box-sizing: border-box; }
    
    body { 
      font-family: 'Plus Jakarta Sans', sans-serif; 
      margin: 0; 
      background: linear-gradient(135deg, #f8fafc 0%, #eff6ff 100%); 
      color: var(--text-main); 
      padding: 16px; 
      min-height: 100vh;
    }

    .app-container { max-width: 480px; margin: 0 auto; width: 100%; }
    
    header { 
      display: flex; gap: 8px; background: var(--glass); 
      backdrop-filter: blur(10px);
      padding: 6px; border-radius: 18px; margin-bottom: 24px; 
      position: sticky; top: 10px; z-index: 100;
      border: 1px solid rgba(255,255,255,0.5);
      box-shadow: var(--card-shadow);
    }
    header button { 
      flex: 1; background: transparent; border: none; padding: 12px 5px; 
      font-weight: 700; border-radius: 14px; cursor: pointer; 
      color: var(--text-muted); font-size: 0.85rem; transition: all 0.3s ease; 
    }
    header button.active { 
      background: var(--accent); color: white; 
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); 
    }

    .card-main { 
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
      padding: 32px 20px; border-radius: 28px; text-align: center; 
      margin-bottom: 20px; color: white;
      box-shadow: 0 20px 25px -5px rgba(79, 70, 229, 0.2);
    }
    .card-main small { opacity: 0.8; font-size: 0.75rem; text-transform: uppercase; font-weight: 600; letter-spacing: 1px; }
    .card-main b { font-size: 2.5rem; display: block; margin-top: 8px; font-weight: 800; }

    .stat-row { display: flex; gap: 12px; margin-bottom: 24px; }
    .stat-card { 
      flex: 1; padding: 16px; border-radius: 20px; background: white; 
      border: 1px solid #f1f5f9; box-shadow: var(--card-shadow);
    }
    .stat-card small { font-size: 0.7rem; font-weight: 700; color: var(--text-muted); display: block; margin-bottom: 4px; }
    .stat-card b { font-size: 1rem; color: var(--text-main); }

    .input-box { 
      background: white; padding: 24px; border-radius: 24px; 
      margin-bottom: 24px; border: 1px solid #f1f5f9; 
      box-shadow: var(--card-shadow);
      border-top-width: 5px;
    }
    .input-box h4 { margin: 0 0 16px 0; font-size: 0.9rem; color: var(--text-main); font-weight: 800; }
    
    .input-bill { border-top-color: var(--danger); }
    .input-expense { border-top-color: var(--warning); }
    .input-debt { border-top-color: var(--purple); }
    .input-wallet { border-top-color: var(--accent); }

    input, select { 
      width: 100%; padding: 14px 16px; border-radius: 14px; 
      border: 1px solid #e2e8f0; background: #f8fafc; 
      font-size: 16px; margin-bottom: 12px; transition: all 0.2s;
    }
    input:focus { border-color: var(--accent); background: white; box-shadow: 0 0 0 4px var(--accent-light); }

    .btn-primary { 
      background: var(--accent); color: white; border: none; width: 100%; 
      padding: 16px; border-radius: 16px; font-weight: 700; cursor: pointer; 
      font-size: 1rem; transition: transform 0.2s;
    }
    .btn-primary:active { transform: scale(0.98); }

    .section-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 5px;
    }
    .section-header h5 { margin: 0; font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
    
    .header-actions { display: flex; gap: 10px; }
    .btn-text-action {
      background: none; border: none; color: var(--accent); font-weight: 700; font-size: 0.75rem; cursor: pointer; padding: 5px;
    }
    .btn-text-action.danger { color: var(--danger); }
    .btn-text-action.success { color: var(--success); }

    #walletGrid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .wallet-card { 
      background: white; padding: 18px; border-radius: 22px; 
      border: 1px solid #f1f5f9; box-shadow: var(--card-shadow);
    }
    .wallet-card b { font-size: 0.8rem; color: var(--text-muted); display: block; }
    .wallet-card span { font-size: 1.1rem; font-weight: 800; color: var(--text-main); display: block; margin: 6px 0 14px 0; }

    .list-item { 
      background: white; padding: 16px; border-radius: 20px; 
      border: 1px solid #f1f5f9; margin-bottom: 12px; 
      display: flex; justify-content: space-between; align-items: center; 
      box-shadow: var(--card-shadow);
      position: relative; overflow: hidden;
    }
    
    .list-item.line-bill { border-left: 6px solid var(--danger); }
    .list-item.line-debt { border-left: 6px solid var(--purple); }
    .list-item.line-expense { border-left: 6px solid var(--warning); }

    .action-btns { display: flex; gap: 8px; }
    .edit-btn, .del-btn { padding: 8px 12px; border-radius: 10px; font-size: 0.75rem; font-weight: 700; border: none; cursor: pointer; }
    .edit-btn { background: #f1f5f9; color: var(--text-muted); }
    .del-btn { background: #fef2f2; color: var(--danger); }
    .pay-btn { background: #ecfdf5; color: var(--success); border: none; padding: 10px 16px; border-radius: 12px; font-weight: 700; }

    .modal-overlay { 
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: rgba(15, 23, 42, 0.4); z-index: 1000; justify-content: center; 
      align-items: center; backdrop-filter: blur(6px); 
    }
    .modal-content { 
      background: white; width: 90%; max-width: 340px; padding: 28px; 
      border-radius: 30px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
    }

    .backup-controls {
      display: flex; flex-direction: column; gap: 10px; margin-top: 30px; margin-bottom: 20px;
    }
    .backup-row { display: flex; gap: 10px; }
    .btn-outline {
      flex: 1; background: white; border: 2px solid #e2e8f0; padding: 12px; border-radius: 14px;
      font-weight: 700; color: var(--text-muted); font-size: 0.8rem; cursor: pointer;
    }
    
    section { display: none; animation: fadeIn 0.4s ease; }
    section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

<div id="customModal" class="modal-overlay">
  <div class="modal-content">
    <h3 id="modalTitle" style="margin:0 0 10px 0; font-weight: 800;">Action</h3>
    <p id="modalDesc" style="color:var(--text-muted); font-size: 0.9rem; margin-bottom: 20px;"></p>
    <div id="modalInputs"></div>
    <div id="modalFooter" style="display: flex; gap: 12px; margin-top: 24px;">
      <button id="modalCancelBtn" onclick="closeModal()" style="flex:1; padding:14px; border-radius:14px; border:none; background:#f1f5f9; font-weight:700; color:var(--text-muted)">Cancel</button>
      <button id="modalConfirmBtn" style="flex:1; padding:14px; border-radius:14px; border:none; font-weight:700;">Confirm</button>
    </div>
  </div>
</div>

<div class="app-container">
  <header>
    <button class="tab-btn active" onclick="showTab('dashboard')">Wallets</button>
    <button class="tab-btn" onclick="showTab('expenses')">Expenses</button>
    <button class="tab-btn" onclick="showTab('debts')">Debts</button>
  </header>

  <section id="dashboard" class="active">
    <div class="card-main">
      <small>Current Savings</small>
      <b>‚Ç±<span id="mainTotal">0.00</span></b>
    </div>
    <div class="input-box input-wallet">
      <h4>Add New Wallet</h4>
      <input type="text" id="wName" placeholder="e.g. GCash, Maya, Cash">
      <input type="number" id="wBal" placeholder="0.00" inputmode="decimal">
      <button class="btn-primary" onclick="addWallet()">Save Wallet</button>
    </div>
    <div class="section-header">
      <h5>Your Wallets</h5>
      <button class="btn-text-action danger" onclick="confirmClearAll('wallets')">Clear All</button>
    </div>
    <div id="walletGrid"></div>

    <div class="backup-controls">
      <button class="btn-outline" style="border-color: var(--accent); color: var(--accent); background: #f5f3ff;" onclick="copyAsText()">üìã Copy All Data (Text)</button>
      <div class="backup-row">
        <button class="btn-outline" onclick="exportData()">üíæ Export JSON</button>
        <button class="btn-outline" onclick="document.getElementById('fileInput').click()">üìÇ Import JSON</button>
      </div>
      <input type="file" id="fileInput" style="display:none" onchange="importData(event)" accept=".json">
    </div>
  </section>

  <section id="expenses">
    <div class="stat-row">
      <div class="stat-card"><small>Safe to Spend</small><b style="color:var(--accent)">‚Ç±<span id="billForecast">0.00</span></b></div>
      <div class="stat-card"><small>Bills Total</small><b style="color:var(--danger)">‚Ç±<span id="totalBillsOnly">0.00</span></b></div>
    </div>
    <div class="input-box input-bill">
      <h4>Record Bill</h4>
      <input type="text" id="bName" placeholder="e.g. Electric, Rent">
      <input type="number" id="bAmt" placeholder="0.00" inputmode="decimal">
      <button class="btn-primary" onclick="addBill()">Add Bill</button>
    </div>
    <div id="billList"></div>
    <div id="billPager" class="pagination-controls"></div>

    <div class="input-box input-expense" style="margin-top: 32px;">
      <h4 style="color:var(--warning)">Quick Spend</h4>
      <input type="number" id="gAmt" placeholder="Amount ‚Ç±" inputmode="decimal">
      <select id="gWalletSelect"></select>
      <button class="btn-primary" style="background:var(--success);" onclick="addDailyExpense()">Record Spend</button>
    </div>
    <div id="historyList"></div>
    <div id="historyPager" class="pagination-controls"></div>
  </section>

  <section id="debts">
    <div class="stat-row">
      <div class="stat-card"><small>After Payback</small><b style="color:var(--accent)">‚Ç±<span id="debtForecast">0.00</span></b></div>
      <div class="stat-card"><small>Active Debts</small><b style="color:#b45309">‚Ç±<span id="totalDebtsOnly">0.00</span></b></div>
    </div>
    <div class="input-box input-debt">
      <h4>Record Debt</h4>
      <input type="text" id="dName" placeholder="Lender's name">
      <input type="number" id="dAmt" placeholder="0.00" inputmode="decimal">
      <button class="btn-primary" style="background:var(--purple);" onclick="addDebt()">Save Debt</button>
    </div>
    <div id="debtList"></div>
    <div id="debtPager" class="pagination-controls"></div>
  </section>
</div>

<script>
  let wallets = JSON.parse(localStorage.getItem('W_FIN_V1')) || [];
  let bills = JSON.parse(localStorage.getItem('B_FIN_V1')) || [];
  let debts = JSON.parse(localStorage.getItem('D_FIN_V1')) || [];
  let history = JSON.parse(localStorage.getItem('H_FIN_V1')) || [];

  let pages = { bills: 0, debts: 0, history: 0 };
  const step = 5;

  function format(v){ return v.toLocaleString('en-PH',{minimumFractionDigits:2}); }
  function save(){
    localStorage.setItem('W_FIN_V1', JSON.stringify(wallets));
    localStorage.setItem('B_FIN_V1', JSON.stringify(bills));
    localStorage.setItem('D_FIN_V1', JSON.stringify(debts));
    localStorage.setItem('H_FIN_V1', JSON.stringify(history));
    refresh();
  }

  // --- NEW: COPY AS TEXT FEATURE ---
  function copyAsText() {
    let text = `üí∞ MONEY TRACKER SUMMARY (${new Date().toLocaleDateString()})\n`;
    text += `==============================\n\n`;
    
    text += `üè¶ WALLETS:\n`;
    wallets.forEach(w => text += `- ${w.name}: ‚Ç±${format(w.balance)}\n`);
    text += `Total Savings: ‚Ç±${format(wallets.reduce((s,w)=>s+w.balance,0))}\n\n`;

    text += `üìë UNPAID BILLS:\n`;
    bills.forEach(b => text += `- ${b.name}: ‚Ç±${format(b.amount)}\n`);
    text += `Total Bills: ‚Ç±${format(bills.reduce((s,b)=>s+b.amount,0))}\n\n`;

    text += `üí∏ DEBTS TO PAY:\n`;
    debts.forEach(d => text += `- ${d.name}: ‚Ç±${format(d.amount)}\n`);
    text += `Total Debts: ‚Ç±${format(debts.reduce((s,d)=>s+d.amount,0))}\n\n`;

    text += `üìú RECENT HISTORY (Last 10):\n`;
    history.slice(-10).reverse().forEach(h => text += `[${h.date}] ${h.name} - ‚Ç±${format(h.amount)}\n`);
    
    text += `\nGenerated via Money Tracker Pro`;

    navigator.clipboard.writeText(text).then(() => {
      showModalAlert("Copied!", "Data summary copied to clipboard. You can now paste it in Notepad or Word.");
    });
  }

  function showTab(id){
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    event.currentTarget.classList.add('active');
  }

  const modal = document.getElementById('customModal');
  function closeModal(){ modal.style.display='none'; }

  function showModalAlert(title, desc, isError = false) {
    document.getElementById('modalTitle').innerText = title;
    document.getElementById('modalDesc').innerText = desc;
    document.getElementById('modalInputs').innerHTML = "";
    document.getElementById('modalCancelBtn').style.display = "none";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Okay";
    btn.style.background = isError ? 'var(--danger)' : 'var(--accent)';
    btn.style.color = 'white';
    btn.onclick = closeModal;
    modal.style.display='flex';
  }

  function addWallet(){
    const n=document.getElementById('wName'), b=document.getElementById('wBal');
    if(n.value){ wallets.push({name:n.value, balance:parseFloat(b.value)||0}); n.value=''; b.value=''; save(); }
  }

  function addBill(){
    const n=document.getElementById('bName'), a=document.getElementById('bAmt');
    if(n.value && a.value){ bills.push({name:n.value, amount:parseFloat(a.value)}); n.value=''; a.value=''; save(); }
  }

  function addDebt(){
    const n=document.getElementById('dName'), a=document.getElementById('dAmt');
    if(n.value && a.value){ debts.push({name:n.value, amount:parseFloat(a.value)}); n.value=''; a.value=''; save(); }
  }

  function addDailyExpense(){
    const a=document.getElementById('gAmt'), wIdx=document.getElementById('gWalletSelect').value;
    if(a.value && wIdx !== ""){
      const amt = parseFloat(a.value);
      const walletName = wallets[wIdx].name;
      if(wallets[wIdx].balance >= amt){
        wallets[wIdx].balance -= amt;
        const now = new Date();
        history.push({
            name: `Expense: ${walletName}`, 
            amount: amt, 
            wallet: walletName, 
            date: now.toLocaleDateString(),
            time: now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
        });
        a.value=''; save();
      } else { 
        showModalAlert("Insufficient Funds", `Your ${walletName} balance is too low.`, true);
      }
    }
  }

  function openEdit(type, idx){
    const list = type==='wallets'?wallets:type==='bills'?bills:type==='debts'?debts:history;
    const item = list[idx];
    document.getElementById('modalTitle').innerText = "Edit Details";
    document.getElementById('modalInputs').innerHTML = `
      <input type="text" id="en" value="${item.name}">
      <input type="number" id="ea" value="${item.balance !== undefined ? item.balance : item.amount}" inputmode="decimal">
    `;
    document.getElementById('modalCancelBtn').style.display = "block";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Save";
    btn.style.background = 'var(--accent)'; btn.style.color = 'white';
    btn.onclick = () => {
      const n = document.getElementById('en').value, a = parseFloat(document.getElementById('ea').value);
      if(type==='wallets') { wallets[idx].name=n; wallets[idx].balance=a; }
      else if(type==='bills') { bills[idx].name=n; bills[idx].amount=a; }
      else if(type==='debts') { debts[idx].name=n; debts[idx].amount=a; }
      else if(type==='history') { history[idx].name=n; history[idx].amount=a; }
      save(); closeModal();
    };
    modal.style.display='flex';
  }

  function confirmDelete(type, idx){
    document.getElementById('modalTitle').innerText = "Delete Record";
    document.getElementById('modalDesc').innerText = "Are you sure?";
    document.getElementById('modalInputs').innerHTML = "";
    document.getElementById('modalCancelBtn').style.display = "block";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Delete";
    btn.style.background = 'var(--danger)'; btn.style.color = 'white';
    btn.onclick = () => {
      if(type==='wallets') wallets.splice(idx,1);
      else if(type==='bills') bills.splice(idx,1);
      else if(type==='debts') debts.splice(idx,1);
      else if(type==='history') history.splice(idx,1);
      save(); closeModal();
    };
    modal.style.display='flex';
  }

  function openPayIndividual(type, idx){
    const list = type==='bills'?bills:debts;
    const item = list[idx];
    const labelPrefix = type === 'bills' ? 'Paid bill' : 'Paid debt';
    document.getElementById('modalTitle').innerText = "Confirm Payment";
    document.getElementById('modalInputs').innerHTML = `<select id="ps">${wallets.map((w,i)=>`<option value="${i}">${w.name} (‚Ç±${format(w.balance)})</option>`).join('')}</select>`;
    document.getElementById('modalCancelBtn').style.display = "block";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Pay Now";
    btn.style.background = 'var(--success)'; btn.style.color = 'white';
    btn.onclick = () => {
      const wIdx = document.getElementById('ps').value;
      if(!wallets[wIdx]) return;
      if(wallets[wIdx].balance >= item.amount){
        wallets[wIdx].balance -= item.amount;
        history.push({ name: `${labelPrefix}: ${wallets[wIdx].name}`, amount: item.amount, wallet: wallets[wIdx].name, date: new Date().toLocaleDateString() });
        list.splice(idx,1); save(); closeModal();
      } else { showModalAlert("Low Balance", "Wallet balance insufficient.", true); }
    };
    modal.style.display='flex';
  }

  function exportData() {
    const blob = new Blob([JSON.stringify({ wallets, bills, debts, history })], { type: 'application/json' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Tracker_Backup.json`; a.click();
  }

  function importData(e) {
    const reader = new FileReader();
    reader.onload = (event) => {
      const data = JSON.parse(event.target.result);
      wallets=data.wallets; bills=data.bills; debts=data.debts; history=data.history; save();
    };
    reader.readAsText(e.target.files[0]);
  }

  function renderPager(id, type, total){
    const max = Math.ceil(total/step);
    if(max <= 1) { document.getElementById(id).innerHTML = ""; return; }
    document.getElementById(id).innerHTML = `<button onclick="pages['${type}']--; refresh()" ${pages[type]===0?'disabled':''} style="padding:8px; border-radius:10px; border:1px solid #ddd; background:white;">‚Üê</button><span style="font-size:0.7rem; margin:0 10px">${pages[type]+1}/${max}</span><button onclick="pages['${type}']++; refresh()" ${pages[type]>=max-1?'disabled':''} style="padding:8px; border-radius:10px; border:1px solid #ddd; background:white;">‚Üí</button>`;
  }

  function refresh(){
    const tCash = wallets.reduce((s,w)=>s+w.balance,0);
    const tBills = bills.reduce((s,b)=>s+b.amount,0);
    const tDebts = debts.reduce((s,d)=>s+d.amount,0);
    document.getElementById('mainTotal').innerText = format(tCash);
    document.getElementById('billForecast').innerText = format(tCash - tBills);
    document.getElementById('totalBillsOnly').innerText = format(tBills);
    document.getElementById('debtForecast').innerText = format(tCash - tDebts);
    document.getElementById('totalDebtsOnly').innerText = format(tDebts);
    document.getElementById('gWalletSelect').innerHTML = wallets.map((w,i)=>`<option value="${i}">${w.name} (‚Ç±${format(w.balance)})</option>`).join('') || '<option value="">No Wallet</option>';
    
    document.getElementById('walletGrid').innerHTML = wallets.map((w,i)=>`<div class="wallet-card"><b>${w.name}</b><span>‚Ç±${format(w.balance)}</span><div class="action-btns"><button class="edit-btn" onclick="openEdit('wallets',${i})">Edit</button><button class="del-btn" onclick="confirmDelete('wallets',${i})">üóë</button></div></div>`).join('');

    const bStart = pages.bills * step;
    document.getElementById('billList').innerHTML = bills.slice(bStart, bStart + step).map((b,i)=>`<div class="list-item line-bill"><div><b>${b.name}</b><br><small>‚Ç±${format(b.amount)}</small></div><div style="text-align:right"><button class="pay-btn" onclick="openPayIndividual('bills',${bStart+i})">Pay</button><div class="action-btns" style="margin-top:8px"><button class="edit-btn" onclick="openEdit('bills',${bStart+i})">Edit</button><button class="del-btn" onclick="confirmDelete('bills',${bStart+i})">üóë</button></div></div></div>`).join('');
    renderPager('billPager', 'bills', bills.length);

    const dStart = pages.debts * step;
    document.getElementById('debtList').innerHTML = debts.slice(dStart, dStart + step).map((d,i)=>`<div class="list-item line-debt"><div><b>${d.name}</b><br><small>‚Ç±${format(d.amount)}</small></div><div style="text-align:right"><button class="pay-btn" onclick="openPayIndividual('debts',${dStart+i})">Pay</button><div class="action-btns" style="margin-top:8px"><button class="edit-btn" onclick="openEdit('debts',${dStart+i})">Edit</button><button class="del-btn" onclick="confirmDelete('debts',${dStart+i})">üóë</button></div></div></div>`).join('');
    renderPager('debtPager', 'debts', debts.length);

    const hReversed = history.slice().reverse();
    const hStart = pages.history * step;
    document.getElementById('historyList').innerHTML = hReversed.slice(hStart, hStart + step).map((h,i)=> {
      let colorClass = 'line-expense';
      if(h.name.includes('Paid bill')) colorClass = 'line-bill';
      if(h.name.includes('Paid debt')) colorClass = 'line-debt';
      return `<div class="list-item ${colorClass}"><div><b>${h.name}</b><br><small>${h.wallet} ‚Ä¢ ${h.date}</small></div><div style="text-align:right"><b style="color:var(--danger)">-‚Ç±${format(h.amount)}</b><div class="action-btns" style="margin-top:8px"><button class="edit-btn" onclick="openEdit('history',${history.length-1-(hStart+i)})">Edit</button><button class="del-btn" onclick="confirmDelete('history',${history.length-1-(hStart+i)})">üóë</button></div></div></div>`;
    }).join('');
    renderPager('historyPager', 'history', history.length);
  }
  refresh();
</script>
</body>
</html>
