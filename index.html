<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Money Tracker Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fdfdfd; --accent: #6366f1; --accent-light: #e0e7ff;
      --success: #059669; --danger: #dc2626; --warning: #f59e0b;
      --purple: #8b5cf6; --text-main: #1e293b; --text-muted: #64748b;
      --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.04), 0 8px 10px -6px rgba(0, 0, 0, 0.04);
      --glass: rgba(255, 255, 255, 0.8);
    }
    * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
    body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; background: #f8fafc; color: var(--text-main); padding: 16px; }
    .app-container { max-width: 480px; margin: 0 auto; width: 100%; }
    header { 
      display: flex; gap: 8px; background: var(--glass); backdrop-filter: blur(10px); padding: 6px; 
      border-radius: 18px; margin-bottom: 24px; position: sticky; top: 10px; z-index: 100;
      border: 1px solid rgba(255,255,255,0.5); box-shadow: var(--card-shadow);
    }
    header button { flex: 1; background: transparent; border: none; padding: 12px 5px; font-weight: 700; border-radius: 14px; cursor: pointer; color: var(--text-muted); font-size: 0.85rem; }
    header button.active { background: var(--accent); color: white; }
    .card-main { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); padding: 30px 20px; border-radius: 28px; text-align: center; margin-bottom: 20px; color: white; }
    .card-main b { font-size: 2.5rem; display: block; margin-top: 5px; font-weight: 800; }
    .stat-row { display: flex; gap: 10px; margin-bottom: 20px; }
    .stat-card { flex: 1; padding: 15px; border-radius: 20px; background: white; border: 1px solid #f1f5f9; box-shadow: var(--card-shadow); }
    .stat-card small { font-size: 0.7rem; font-weight: 700; color: var(--text-muted); display: block; }
    .input-box { background: white; padding: 20px; border-radius: 24px; margin-bottom: 20px; border: 1px solid #f1f5f9; border-top-width: 6px; }
    .input-bill { border-top-color: var(--danger); }
    .input-expense { border-top-color: var(--warning); }
    .input-debt { border-top-color: var(--purple); }
    .input-wallet { border-top-color: var(--accent); }
    input, select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 10px; font-size: 16px; }
    .btn-primary { background: var(--accent); color: white; border: none; width: 100%; padding: 14px; border-radius: 14px; font-weight: 700; cursor: pointer; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin: 15px 0 10px; padding: 0 5px; }
    .section-header h5 { margin: 0; font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; }
    .btn-text-action { background: none; border: none; font-weight: 700; font-size: 0.75rem; cursor: pointer; }
    .btn-text-action.danger { color: var(--danger); } .btn-text-action.success { color: var(--success); }
    .list-item { background: white; padding: 15px; border-radius: 20px; border: 1px solid #f1f5f9; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    .line-bill { border-left: 6px solid var(--danger); }
    .line-debt { border-left: 6px solid var(--purple); }
    .line-expense { border-left: 6px solid var(--warning); }
    .action-btns { display: flex; gap: 6px; margin-top: 8px; }
    .edit-btn, .del-btn { padding: 6px 10px; border-radius: 8px; font-size: 0.7rem; border: none; cursor: pointer; font-weight: 700; }
    .edit-btn { background: #f1f5f9; } .del-btn { background: #fff1f2; color: var(--danger); }
    .pay-btn { background: #ecfdf5; color: var(--success); border: none; padding: 8px 12px; border-radius: 10px; font-weight: 800; }
    .pagination-controls { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
    .modal-content { background: white; width: 90%; max-width: 320px; padding: 25px; border-radius: 25px; text-align: center; }
    section { display: none; } section.active { display: block; }
  </style>
</head>
<body>

<div id="customModal" class="modal-overlay">
  <div class="modal-content">
    <h3 id="modalTitle" style="margin-top:0">Action</h3>
    <p id="modalDesc" style="color:var(--text-muted); font-size: 0.9rem; margin-bottom: 15px;"></p>
    <div id="modalInputs"></div>
    <div id="modalFooter" style="display:flex; gap:10px; margin-top:20px">
      <button id="modalCancelBtn" onclick="closeModal()" style="flex:1; padding:12px; border:none; border-radius:12px; background:#f1f5f9; font-weight:700">Cancel</button>
      <button id="modalConfirmBtn" style="flex:1; padding:12px; border:none; border-radius:12px; color:white; font-weight:700">Confirm</button>
    </div>
  </div>
</div>

<div class="app-container">
  <header>
    <button class="tab-btn active" onclick="showTab('dashboard')">Wallets</button>
    <button class="tab-btn" onclick="showTab('expenses')">Expenses</button>
    <button class="tab-btn" onclick="showTab('debts')">Debts</button>
  </header>

  <section id="dashboard" class="active">
    <div class="card-main"><small>Total Savings</small><b>‚Ç±<span id="mainTotal">0.00</span></b></div>
    <div class="input-box input-wallet">
      <h4>Add Wallet</h4>
      <input type="text" id="wName" placeholder="Name (e.g. GCash)">
      <input type="number" id="wBal" placeholder="Balance ‚Ç±">
      <button class="btn-primary" onclick="addWallet()">Save Wallet</button>
    </div>
    <div class="section-header"><h5>Wallets</h5><button class="btn-text-action danger" onclick="confirmClearAll('wallets')">Clear All</button></div>
    <div id="walletGrid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px"></div>
    <div style="margin-top:20px; display:flex; flex-direction:column; gap:10px">
      <button class="btn-primary" style="background:#f5f3ff; color:var(--accent); border:1px solid var(--accent)" onclick="copyAsText()">üìã Copy Summary (Text)</button>
      <div style="display:flex; gap:10px">
        <button onclick="exportData()" style="flex:1; padding:10px; border-radius:10px; border:1px solid #ddd; background:white">üíæ Export</button>
        <button onclick="document.getElementById('fileInput').click()" style="flex:1; padding:10px; border-radius:10px; border:1px solid #ddd; background:white">üìÇ Import</button>
      </div>
      <input type="file" id="fileInput" style="display:none" onchange="importData(event)">
    </div>
  </section>

  <section id="expenses">
    <div class="stat-row">
      <div class="stat-card"><small>Available</small><b style="color:var(--accent)">‚Ç±<span id="billForecast">0.00</span></b></div>
      <div class="stat-card"><small>Bills Total</small><b style="color:var(--danger)">‚Ç±<span id="totalBillsOnly">0.00</span></b></div>
    </div>
    <div class="input-box input-bill">
      <h4>Add Bill</h4>
      <input type="text" id="bName" placeholder="Bill Name">
      <input type="number" id="bAmt" placeholder="Amount ‚Ç±">
      <button class="btn-primary" onclick="addBill()">Save Bill</button>
    </div>
    <div class="section-header"><h5>Active Bills</h5><div><button class="btn-text-action success" onclick="openPayAll('bills')">Pay All</button> | <button class="btn-text-action danger" onclick="confirmClearAll('bills')">Clear</button></div></div>
    <div id="billList"></div><div id="billPager" class="pagination-controls"></div>
    <div class="input-box input-expense">
      <h4>Quick Spend</h4>
      <input type="number" id="gAmt" placeholder="Amount ‚Ç±">
      <select id="gWalletSelect"></select>
      <button class="btn-primary" style="background:var(--success)" onclick="addDailyExpense()">Record Spend</button>
    </div>
    <div class="section-header"><h5>History</h5><button class="btn-text-action danger" onclick="confirmClearAll('history')">Clear All</button></div>
    <div id="historyList"></div><div id="historyPager" class="pagination-controls"></div>
  </section>

  <section id="debts">
    <div class="stat-row">
      <div class="stat-card"><small>After Payback</small><b style="color:var(--accent)">‚Ç±<span id="debtForecast">0.00</span></b></div>
      <div class="stat-card"><small>Total Debts</small><b style="color:var(--purple)">‚Ç±<span id="totalDebtsOnly">0.00</span></b></div>
    </div>
    <div class="input-box input-debt">
      <h4>Add Debt</h4>
      <input type="text" id="dName" placeholder="Lender">
      <input type="number" id="dAmt" placeholder="Amount ‚Ç±">
      <button class="btn-primary" style="background:var(--purple)" onclick="addDebt()">Save Debt</button>
    </div>
    <div class="section-header"><h5>Debt List</h5><div><button class="btn-text-action success" onclick="openPayAll('debts')">Pay All</button> | <button class="btn-text-action danger" onclick="confirmClearAll('debts')">Clear</button></div></div>
    <div id="debtList"></div><div id="debtPager" class="pagination-controls"></div>
  </section>
</div>

<script>
  let wallets = JSON.parse(localStorage.getItem('W_F')) || [];
  let bills = JSON.parse(localStorage.getItem('B_F')) || [];
  let debts = JSON.parse(localStorage.getItem('D_F')) || [];
  let history = JSON.parse(localStorage.getItem('H_F')) || [];
  let pages = { bills: 0, debts: 0, history: 0 };
  const step = 5;

  function format(v){ return v.toLocaleString('en-PH',{minimumFractionDigits:2}); }
  function save(){
    localStorage.setItem('W_F', JSON.stringify(wallets));
    localStorage.setItem('B_F', JSON.stringify(bills));
    localStorage.setItem('D_F', JSON.stringify(debts));
    localStorage.setItem('H_F', JSON.stringify(history));
    refresh();
  }

  function showTab(id){
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    event.currentTarget.classList.add('active');
  }

  function closeModal(){ document.getElementById('customModal').style.display='none'; }

  function showModalAlert(title, desc, isError = false) {
    document.getElementById('modalTitle').innerText = title;
    document.getElementById('modalDesc').innerText = desc;
    document.getElementById('modalInputs').innerHTML = "";
    document.getElementById('modalCancelBtn').style.display = "none";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Okay";
    btn.style.background = isError ? 'var(--danger)' : 'var(--accent)';
    btn.onclick = closeModal;
    document.getElementById('customModal').style.display='flex';
  }

  function addWallet(){
    const n=document.getElementById('wName'), b=document.getElementById('wBal');
    if(n.value){ wallets.push({name:n.value, balance:parseFloat(b.value)||0}); n.value=''; b.value=''; save(); }
  }

  function addBill(){
    const n=document.getElementById('bName'), a=document.getElementById('bAmt');
    if(n.value && a.value){ bills.push({name:n.value, amount:parseFloat(a.value)}); n.value=''; a.value=''; save(); }
  }

  function addDebt(){
    const n=document.getElementById('dName'), a=document.getElementById('dAmt');
    if(n.value && a.value){ debts.push({name:n.value, amount:parseFloat(a.value)}); n.value=''; a.value=''; save(); }
  }

  function addDailyExpense(){
    const a=document.getElementById('gAmt'), wIdx=document.getElementById('gWalletSelect').value;
    if(a.value && wIdx !== ""){
      const amt = parseFloat(a.value);
      if(wallets[wIdx].balance >= amt){
        wallets[wIdx].balance -= amt;
        history.push({ name: `Spend: ${wallets[wIdx].name}`, amount: amt, wallet: wallets[wIdx].name, date: new Date().toLocaleDateString() });
        a.value=''; save();
      } else { showModalAlert("Low Balance", "Insufficient funds in the selected wallet!", true); }
    }
  }

  function openEdit(type, idx){
    const list = type==='wallets'?wallets:type==='bills'?bills:type==='debts'?debts:history;
    const item = list[idx];
    document.getElementById('modalTitle').innerText = "Edit Details";
    document.getElementById('modalDesc').innerText = "";
    document.getElementById('modalInputs').innerHTML = `<input type="text" id="en" value="${item.name}"><input type="number" id="ea" value="${item.balance !== undefined ? item.balance : item.amount}">`;
    document.getElementById('modalCancelBtn').style.display = "block";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Save"; btn.style.background = 'var(--accent)';
    btn.onclick = () => {
      const n = document.getElementById('en').value;
      const a = parseFloat(document.getElementById('ea').value);
      if(type==='wallets') { wallets[idx].name=n; wallets[idx].balance=a; }
      else { list[idx].name=n; list[idx].amount=a; }
      save(); closeModal();
    };
    document.getElementById('customModal').style.display='flex';
  }

  function confirmDelete(type, idx){
    document.getElementById('modalTitle').innerText = "Delete Record?";
    document.getElementById('modalDesc').innerText = "Are you sure you want to delete this item?";
    document.getElementById('modalInputs').innerHTML = "";
    document.getElementById('modalCancelBtn').style.display = "block";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Delete"; btn.style.background = 'var(--danger)';
    btn.onclick = () => {
      if(type==='wallets') wallets.splice(idx,1);
      else if(type==='bills') bills.splice(idx,1);
      else if(type==='debts') debts.splice(idx,1);
      else history.splice(idx,1);
      save(); closeModal();
    };
    document.getElementById('customModal').style.display='flex';
  }

  function confirmClearAll(type){
    document.getElementById('modalTitle').innerText = "Clear All " + type + "?";
    document.getElementById('modalDesc').innerText = "All data in this section will be permanently removed.";
    document.getElementById('modalInputs').innerHTML = "";
    document.getElementById('modalCancelBtn').style.display = "block";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Clear All"; btn.style.background = 'var(--danger)';
    btn.onclick = () => {
      if(type==='wallets') wallets=[]; else if(type==='bills') bills=[]; else if(type==='debts') debts=[]; else history=[];
      save(); closeModal();
    };
    document.getElementById('customModal').style.display='flex';
  }

  function openPayIndividual(type, idx){
    const list = type==='bills'?bills:debts;
    document.getElementById('modalTitle').innerText = "Pay " + list[idx].name;
    document.getElementById('modalDesc').innerText = "Select payment wallet:";
    document.getElementById('modalInputs').innerHTML = `<select id="ps">${wallets.map((w,i)=>`<option value="${i}">${w.name} (‚Ç±${format(w.balance)})</option>`).join('')}</select>`;
    document.getElementById('modalCancelBtn').style.display = "block";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Pay Now"; btn.style.background = 'var(--success)';
    btn.onclick = () => {
      const wIdx = document.getElementById('ps').value;
      if(wallets[wIdx].balance >= list[idx].amount){
        wallets[wIdx].balance -= list[idx].amount;
        history.push({ name: `Paid ${type}: ${list[idx].name}`, amount: list[idx].amount, wallet: wallets[wIdx].name, date: new Date().toLocaleDateString() });
        list.splice(idx,1); save(); closeModal();
      } else { closeModal(); showModalAlert("Low Balance", "Insufficient funds in this wallet!", true); }
    };
    document.getElementById('customModal').style.display='flex';
  }

  function openPayAll(type) {
    const list = type === 'bills' ? bills : debts;
    if(!list.length) return;
    document.getElementById('modalTitle').innerText = "Pay All " + type;
    document.getElementById('modalDesc').innerText = "Deduct all from selected wallet:";
    document.getElementById('modalInputs').innerHTML = `<select id="ps">${wallets.map((w,i)=>`<option value="${i}">${w.name} (‚Ç±${format(w.balance)})</option>`).join('')}</select>`;
    document.getElementById('modalCancelBtn').style.display = "block";
    const btn = document.getElementById('modalConfirmBtn');
    btn.innerText = "Pay All Now"; btn.style.background = 'var(--success)';
    btn.onclick = () => {
      const wIdx = document.getElementById('ps').value;
      while(list.length > 0 && wallets[wIdx].balance >= list[0].amount){
        let itm = list.shift();
        wallets[wIdx].balance -= itm.amount;
        history.push({ name: `Paid ${type}: ${itm.name}`, amount: itm.amount, wallet: wallets[wIdx].name, date: new Date().toLocaleDateString() });
      }
      save(); closeModal();
    };
    document.getElementById('customModal').style.display='flex';
  }

  function copyAsText(){
    let t = `üí∞ MONEY SUMMARY (${new Date().toLocaleDateString()})\n\nüè¶ WALLETS:\n` + wallets.map(w => `- ${w.name}: ‚Ç±${format(w.balance)}`).join('\n');
    t += `\n\nüìë UNPAID BILLS:\n` + bills.map(b => `- ${b.name}: ‚Ç±${format(b.amount)}`).join('\n');
    t += `\n\nüí∏ DEBTS:\n` + debts.map(d => `- ${d.name}: ‚Ç±${format(d.amount)}`).join('\n');
    navigator.clipboard.writeText(t).then(()=>showModalAlert("Copied!", "Summary copied to clipboard. Ready to paste."));
  }

  function exportData(){ const b=new Blob([JSON.stringify({wallets,bills,debts,history})],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='Tracker_Backup.json'; a.click(); }
  function importData(e){ const r=new FileReader(); r.onload=(ev)=>{ const d=JSON.parse(ev.target.result); wallets=d.wallets; bills=d.bills; debts=d.debts; history=d.history; save(); }; r.readAsText(e.target.files[0]); }

  function renderPager(id, type, total){
    const max = Math.ceil(total/step);
    if(max <= 1) { document.getElementById(id).innerHTML=""; return; }
    document.getElementById(id).innerHTML = `<button onclick="pages['${type}']--; refresh()" ${pages[type]===0?'disabled':''} style="padding:5px 12px; border-radius:10px; border:1px solid #ddd; background:white">‚Üê</button> <span style="font-size:0.75rem">${pages[type]+1}/${max}</span> <button onclick="pages['${type}']++; refresh()" ${pages[type]>=max-1?'disabled':''} style="padding:5px 12px; border-radius:10px; border:1px solid #ddd; background:white">‚Üí</button>`;
  }

  function refresh(){
    const tCash = wallets.reduce((s,w)=>s+w.balance,0);
    const tBills = bills.reduce((s,b)=>s+b.amount,0);
    const tDebts = debts.reduce((s,d)=>s+d.amount,0);
    document.getElementById('mainTotal').innerText = format(tCash);
    document.getElementById('billForecast').innerText = format(tCash - tBills);
    document.getElementById('totalBillsOnly').innerText = format(tBills);
    document.getElementById('debtForecast').innerText = format(tCash - tDebts);
    document.getElementById('totalDebtsOnly').innerText = format(tDebts);
    document.getElementById('gWalletSelect').innerHTML = wallets.map((w,i)=>`<option value="${i}">${w.name} (‚Ç±${format(w.balance)})</option>`).join('');

    document.getElementById('walletGrid').innerHTML = wallets.map((w,i)=>`<div style="background:white; padding:15px; border-radius:18px; border:1px solid #eee"><b>${w.name}</b><br>‚Ç±${format(w.balance)}<div class="action-btns"><button class="edit-btn" onclick="openEdit('wallets',${i})">Edit</button><button class="del-btn" onclick="confirmDelete('wallets',${i})">üóë</button></div></div>`).join('');

    const bS = pages.bills * step;
    document.getElementById('billList').innerHTML = bills.slice(bS, bS+step).map((b,i)=>`<div class="list-item line-bill"><div><b>${b.name}</b><br><small>‚Ç±${format(b.amount)}</small><div class="action-btns"><button class="edit-btn" onclick="openEdit('bills',${bS+i})">Edit</button><button class="del-btn" onclick="confirmDelete('bills',${bS+i})">üóë</button></div></div><button class="pay-btn" onclick="openPayIndividual('bills',${bS+i})">Pay</button></div>`).join('');
    renderPager('billPager', 'bills', bills.length);

    const dS = pages.debts * step;
    document.getElementById('debtList').innerHTML = debts.slice(dS, dS+step).map((d,i)=>`<div class="list-item line-debt"><div><b>${d.name}</b><br><small>‚Ç±${format(d.amount)}</small><div class="action-btns"><button class="edit-btn" onclick="openEdit('debts',${dS+i})">Edit</button><button class="del-btn" onclick="confirmDelete('debts',${dS+i})">üóë</button></div></div><button class="pay-btn" onclick="openPayIndividual('debts',${dS+i})">Pay</button></div>`).join('');
    renderPager('debtPager', 'debts', debts.length);

    const hR = [...history].reverse();
    const hS = pages.history * step;
    document.getElementById('historyList').innerHTML = hR.slice(hS, hS+step).map((h,i)=>`<div class="list-item ${h.name.includes('Paid bills')?'line-bill':h.name.includes('Paid debts')?'line-debt':'line-expense'}"><div><b>${h.name}</b><br><small>${h.wallet} ‚Ä¢ ${h.date}</small><div class="action-btns"><button class="del-btn" onclick="confirmDelete('history',${history.length-1-(hS+i)})">üóë</button></div></div><b style="color:var(--danger)">-‚Ç±${format(h.amount)}</b></div>`).join('');
    renderPager('historyPager', 'history', history.length);
  }
  refresh();
</script>
</body>
</html>
