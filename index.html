<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Money Tracker Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fdfdfd;
      --accent: #6366f1;
      --accent-light: #e0e7ff;
      --success: #059669;
      --danger: #dc2626;
      --text-main: #1e293b;
      --text-muted: #64748b;
      --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.04), 0 8px 10px -6px rgba(0, 0, 0, 0.04);
      --glass: rgba(255, 255, 255, 0.8);
    }

    * { -webkit-tap-highlight-color: transparent; outline: none; box-sizing: border-box; }
    
    body { 
      font-family: 'Plus Jakarta Sans', sans-serif; 
      margin: 0; 
      background: linear-gradient(135deg, #f8fafc 0%, #eff6ff 100%); 
      color: var(--text-main); 
      padding: 16px; 
      min-height: 100vh;
    }

    .app-container { max-width: 480px; margin: 0 auto; width: 100%; }
    
    header { 
      display: flex; gap: 8px; background: var(--glass); 
      backdrop-filter: blur(10px);
      padding: 6px; border-radius: 18px; margin-bottom: 24px; 
      position: sticky; top: 10px; z-index: 100;
      border: 1px solid rgba(255,255,255,0.5);
      box-shadow: var(--card-shadow);
    }
    header button { 
      flex: 1; background: transparent; border: none; padding: 12px 5px; 
      font-weight: 700; border-radius: 14px; cursor: pointer; 
      color: var(--text-muted); font-size: 0.85rem; transition: all 0.3s ease; 
    }
    header button.active { 
      background: var(--accent); color: white; 
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); 
    }

    .card-main { 
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
      padding: 32px 20px; border-radius: 28px; text-align: center; 
      margin-bottom: 20px; color: white;
      box-shadow: 0 20px 25px -5px rgba(79, 70, 229, 0.2);
    }
    .card-main small { opacity: 0.8; font-size: 0.75rem; text-transform: uppercase; font-weight: 600; letter-spacing: 1px; }
    .card-main b { font-size: 2.5rem; display: block; margin-top: 8px; font-weight: 800; }

    .stat-row { display: flex; gap: 12px; margin-bottom: 24px; }
    .stat-card { 
      flex: 1; padding: 16px; border-radius: 20px; background: white; 
      border: 1px solid #f1f5f9; box-shadow: var(--card-shadow);
    }
    .stat-card small { font-size: 0.7rem; font-weight: 700; color: var(--text-muted); display: block; margin-bottom: 4px; }
    .stat-card b { font-size: 1rem; color: var(--text-main); }

    .input-box { 
      background: white; padding: 24px; border-radius: 24px; 
      margin-bottom: 24px; border: 1px solid #f1f5f9; 
      box-shadow: var(--card-shadow);
    }
    .input-box h4 { margin: 0 0 16px 0; font-size: 0.9rem; color: var(--text-main); font-weight: 800; }
    
    input, select { 
      width: 100%; padding: 14px 16px; border-radius: 14px; 
      border: 1px solid #e2e8f0; background: #f8fafc; 
      font-size: 16px; margin-bottom: 12px; transition: all 0.2s;
    }
    input:focus { border-color: var(--accent); background: white; box-shadow: 0 0 0 4px var(--accent-light); }

    .btn-primary { 
      background: var(--accent); color: white; border: none; width: 100%; 
      padding: 16px; border-radius: 16px; font-weight: 700; cursor: pointer; 
      font-size: 1rem; transition: transform 0.2s;
    }
    .btn-primary:active { transform: scale(0.98); }

    .section-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 5px;
    }
    .section-header h5 { margin: 0; font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
    
    .header-actions { display: flex; gap: 10px; }
    .btn-text-action {
      background: none; border: none; color: var(--accent); font-weight: 700; font-size: 0.75rem; cursor: pointer; padding: 5px;
    }
    .btn-text-action.danger { color: var(--danger); }
    .btn-text-action.success { color: var(--success); }

    #walletGrid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .wallet-card { 
      background: white; padding: 18px; border-radius: 22px; 
      border: 1px solid #f1f5f9; box-shadow: var(--card-shadow);
    }
    .wallet-card b { font-size: 0.8rem; color: var(--text-muted); display: block; }
    .wallet-card span { font-size: 1.1rem; font-weight: 800; color: var(--text-main); display: block; margin: 6px 0 14px 0; }

    .list-item { 
      background: white; padding: 16px; border-radius: 20px; 
      border: 1px solid #f1f5f9; margin-bottom: 12px; 
      display: flex; justify-content: space-between; align-items: center; 
      box-shadow: var(--card-shadow);
    }

    .action-btns { display: flex; gap: 8px; }
    .edit-btn, .del-btn { padding: 8px 12px; border-radius: 10px; font-size: 0.75rem; font-weight: 700; border: none; cursor: pointer; }
    .edit-btn { background: #f1f5f9; color: var(--text-muted); }
    .del-btn { background: #fef2f2; color: var(--danger); }
    .pay-btn { background: #ecfdf5; color: var(--success); border: none; padding: 10px 16px; border-radius: 12px; font-weight: 700; }

    .modal-overlay { 
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: rgba(15, 23, 42, 0.4); z-index: 1000; justify-content: center; 
      align-items: center; backdrop-filter: blur(6px); 
    }
    .modal-content { 
      background: white; width: 90%; max-width: 340px; padding: 28px; 
      border-radius: 30px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
    }
    
    section { display: none; animation: fadeIn 0.4s ease; }
    section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

<div id="customModal" class="modal-overlay">
  <div class="modal-content">
    <h3 id="modalTitle" style="margin:0 0 10px 0; font-weight: 800;">Action</h3>
    <p id="modalDesc" style="color:var(--text-muted); font-size: 0.9rem; margin-bottom: 20px;"></p>
    <div id="modalInputs"></div>
    <div style="display: flex; gap: 12px; margin-top: 24px;">
      <button onclick="closeModal()" style="flex:1; padding:14px; border-radius:14px; border:none; background:#f1f5f9; font-weight:700; color:var(--text-muted)">Cancel</button>
      <button id="modalConfirmBtn" style="flex:1; padding:14px; border-radius:14px; border:none; font-weight:700;">Confirm</button>
    </div>
  </div>
</div>

<div class="app-container">
  <header>
    <button class="tab-btn active" onclick="showTab('dashboard')">Wallets</button>
    <button class="tab-btn" onclick="showTab('expenses')">Expenses</button>
    <button class="tab-btn" onclick="showTab('debts')">Debts</button>
  </header>

  <section id="dashboard" class="active">
    <div class="card-main">
      <small>Current Savings</small>
      <b>‚Ç±<span id="mainTotal">0.00</span></b>
    </div>
    <div class="input-box">
      <h4>Add New Wallet</h4>
      <input type="text" id="wName" placeholder="e.g. GCash, Maya, Cash">
      <input type="number" id="wBal" placeholder="0.00" inputmode="decimal">
      <button class="btn-primary" onclick="addWallet()">Save Wallet</button>
    </div>
    <div class="section-header">
      <h5>Your Wallets</h5>
      <button class="btn-text-action danger" onclick="confirmClearAll('wallets')">Clear All</button>
    </div>
    <div id="walletGrid"></div>
  </section>

  <section id="expenses">
    <div class="stat-row">
      <div class="stat-card"><small>Safe to Spend</small><b style="color:var(--accent)">‚Ç±<span id="billForecast">0.00</span></b></div>
      <div class="stat-card"><small>Bills Total</small><b style="color:var(--danger)">‚Ç±<span id="totalBillsOnly">0.00</span></b></div>
    </div>
    <div class="input-box">
      <h4>Record Bill</h4>
      <input type="text" id="bName" placeholder="e.g. Electric, Rent">
      <input type="number" id="bAmt" placeholder="0.00" inputmode="decimal">
      <button class="btn-primary" onclick="addBill()">Add Bill</button>
    </div>
    <div class="section-header">
      <h5>Active Bills</h5>
      <div class="header-actions">
        <button class="btn-text-action success" onclick="openPayAll('bills')">Pay All</button>
        <button class="btn-text-action danger" onclick="confirmClearAll('bills')">Clear All</button>
      </div>
    </div>
    <div id="billList"></div>
    <div id="billPager" class="pagination-controls"></div>

    <div class="input-box" style="margin-top: 32px; border-top: 4px solid var(--success);">
      <h4 style="color:var(--success)">Quick Spend</h4>
      <input type="number" id="gAmt" placeholder="Amount ‚Ç±" inputmode="decimal">
      <select id="gWalletSelect"></select>
      <button class="btn-primary" style="background:var(--success);" onclick="addDailyExpense()">Record Spend</button>
    </div>
    <div class="section-header">
      <h5>History</h5>
      <button class="btn-text-action danger" onclick="confirmClearAll('history')">Clear All</button>
    </div>
    <div id="historyList"></div>
    <div id="historyPager" class="pagination-controls"></div>
  </section>

  <section id="debts">
    <div class="stat-row">
      <div class="stat-card"><small>After Payback</small><b style="color:var(--accent)">‚Ç±<span id="debtForecast">0.00</span></b></div>
      <div class="stat-card"><small>Active Debts</small><b style="color:#b45309">‚Ç±<span id="totalDebtsOnly">0.00</span></b></div>
    </div>
    <div class="input-box">
      <h4>Record Debt</h4>
      <input type="text" id="dName" placeholder="Lender's name">
      <input type="number" id="dAmt" placeholder="0.00" inputmode="decimal">
      <button class="btn-primary" onclick="addDebt()">Save Debt</button>
    </div>
    <div class="section-header">
      <h5>Debt List</h5>
      <div class="header-actions">
        <button class="btn-text-action success" onclick="openPayAll('debts')">Pay All</button>
        <button class="btn-text-action danger" onclick="confirmClearAll('debts')">Clear All</button>
      </div>
    </div>
    <div id="debtList"></div>
    <div id="debtPager" class="pagination-controls"></div>
  </section>
</div>

<script>
  let wallets = JSON.parse(localStorage.getItem('W_FIN_V1')) || [];
  let bills = JSON.parse(localStorage.getItem('B_FIN_V1')) || [];
  let debts = JSON.parse(localStorage.getItem('D_FIN_V1')) || [];
  let history = JSON.parse(localStorage.getItem('H_FIN_V1')) || [];

  let pages = { bills: 0, debts: 0, history: 0 };
  const step = 5;

  function format(v){ return v.toLocaleString('en-PH',{minimumFractionDigits:2}); }
  function save(){
    localStorage.setItem('W_FIN_V1', JSON.stringify(wallets));
    localStorage.setItem('B_FIN_V1', JSON.stringify(bills));
    localStorage.setItem('D_FIN_V1', JSON.stringify(debts));
    localStorage.setItem('H_FIN_V1', JSON.stringify(history));
    refresh();
  }

  function showTab(id){
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    event.currentTarget.classList.add('active');
  }

  function addWallet(){
    const n=document.getElementById('wName'), b=document.getElementById('wBal');
    if(n.value){ wallets.push({name:n.value, balance:parseFloat(b.value)||0}); n.value=''; b.value=''; save(); }
  }

  function addBill(){
    const n=document.getElementById('bName'), a=document.getElementById('bAmt');
    if(n.value && a.value){ bills.push({name:n.value, amount:parseFloat(a.value)}); n.value=''; a.value=''; save(); }
  }

  function addDebt(){
    const n=document.getElementById('dName'), a=document.getElementById('dAmt');
    if(n.value && a.value){ debts.push({name:n.value, amount:parseFloat(a.value)}); n.value=''; a.value=''; save(); }
  }

  function addDailyExpense(){
    const a=document.getElementById('gAmt'), wIdx=document.getElementById('gWalletSelect').value;
    if(a.value && wIdx !== ""){
      const amt = parseFloat(a.value);
      if(wallets[wIdx].balance >= amt){
        wallets[wIdx].balance -= amt;
        const now = new Date();
        history.push({
            name: "Daily Spend", amount: amt, wallet: wallets[wIdx].name, 
            date: now.toLocaleDateString(),
            time: now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
        });
        a.value=''; save();
      } else { alert("Insufficient funds!"); }
    }
  }

  const modal = document.getElementById('customModal');
  function closeModal(){ modal.style.display='none'; }

  function openPayAll(type) {
    const list = type === 'bills' ? bills : debts;
    if (list.length === 0) return;
    const total = list.reduce((s, x) => s + x.amount, 0);
    
    document.getElementById('modalTitle').innerText = "Pay All " + (type==='bills'?'Bills':'Debts');
    document.getElementById('modalDesc').innerText = `Total: ‚Ç±${format(total)}. Select Wallet:`;
    document.getElementById('modalInputs').innerHTML = `<select id="ps">${wallets.map((w,i)=>`<option value="${i}">${w.name} (‚Ç±${format(w.balance)})</option>`).join('')}</select>`;
    
    const btn = document.getElementById('modalConfirmBtn');
    btn.style.background = 'var(--success)'; btn.style.color = 'white';
    btn.onclick = () => {
      const wIdx = document.getElementById('ps').value;
      if (!wallets[wIdx]) return;
      
      let walletBal = wallets[wIdx].balance;
      let paidCount = 0;
      
      // Pay as many as possible from the start of the list
      while (list.length > 0 && walletBal >= list[0].amount) {
        let item = list.shift();
        walletBal -= item.amount;
        history.push({
          name: `Paid (All): ${item.name}`, 
          amount: item.amount, 
          wallet: wallets[wIdx].name, 
          date: new Date().toLocaleDateString(), 
          time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
        });
        paidCount++;
      }
      
      wallets[wIdx].balance = walletBal;
      save(); closeModal();
      if (paidCount === 0) alert("Insufficient funds in selected wallet!");
    };
    modal.style.display='flex';
  }

  function confirmClearAll(type) {
    document.getElementById('modalTitle').innerText = "Clear All Records?";
    document.getElementById('modalDesc').innerText = `Warning: This will delete all your ${type} data forever.`;
    document.getElementById('modalInputs').innerHTML = "";
    const btn = document.getElementById('modalConfirmBtn');
    btn.style.background = 'var(--danger)'; btn.style.color = 'white';
    btn.onclick = () => {
      if(type==='wallets') wallets = [];
      else if(type==='bills') bills = [];
      else if(type==='debts') debts = [];
      else if(type==='history') history = [];
      save(); closeModal();
    };
    modal.style.display='flex';
  }

  function openEdit(type, idx){
    const list = type==='wallets'?wallets:type==='bills'?bills:type==='debts'?debts:history;
    const item = list[idx];
    document.getElementById('modalTitle').innerText = "Edit Details";
    document.getElementById('modalInputs').innerHTML = `
      <input type="text" id="en" value="${item.name}">
      <input type="number" id="ea" value="${item.balance !== undefined ? item.balance : item.amount}" inputmode="decimal">
    `;
    const btn = document.getElementById('modalConfirmBtn');
    btn.style.background = 'var(--accent)'; btn.style.color = 'white';
    btn.onclick = () => {
      const n = document.getElementById('en').value, a = parseFloat(document.getElementById('ea').value);
      if(type==='wallets') { wallets[idx].name=n; wallets[idx].balance=a; }
      else if(type==='bills') { bills[idx].name=n; bills[idx].amount=a; }
      else if(type==='debts') { debts[idx].name=n; debts[idx].amount=a; }
      else if(type==='history') { history[idx].name=n; history[idx].amount=a; }
      save(); closeModal();
    };
    modal.style.display='flex';
  }

  function confirmDelete(type, idx){
    document.getElementById('modalTitle').innerText = "Delete Record";
    document.getElementById('modalDesc').innerText = "Are you sure you want to remove this?";
    document.getElementById('modalInputs').innerHTML = "";
    const btn = document.getElementById('modalConfirmBtn');
    btn.style.background = 'var(--danger)'; btn.style.color = 'white';
    btn.onclick = () => {
      if(type==='wallets') wallets.splice(idx,1);
      else if(type==='bills') bills.splice(idx,1);
      else if(type==='debts') debts.splice(idx,1);
      else if(type==='history') history.splice(idx,1);
      save(); closeModal();
    };
    modal.style.display='flex';
  }

  function openPayIndividual(type, idx){
    const list = type==='bills'?bills:debts;
    const item = list[idx];
    document.getElementById('modalTitle').innerText = "Payment Confirmation";
    document.getElementById('modalDesc').innerText = `Pay ‚Ç±${format(item.amount)} using:`;
    document.getElementById('modalInputs').innerHTML = `<select id="ps">${wallets.map((w,i)=>`<option value="${i}">${w.name} (‚Ç±${format(w.balance)})</option>`).join('')}</select>`;
    const btn = document.getElementById('modalConfirmBtn');
    btn.style.background = 'var(--success)'; btn.style.color = 'white';
    btn.onclick = () => {
      const wIdx = document.getElementById('ps').value;
      if(!wallets[wIdx]) return;
      if(wallets[wIdx].balance >= item.amount){
        wallets[wIdx].balance -= item.amount;
        history.push({name: `Paid: ${item.name}`, amount: item.amount, wallet: wallets[wIdx].name, date: new Date().toLocaleDateString(), time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})});
        list.splice(idx,1); save(); closeModal();
      } else { alert("Insufficient funds!"); }
    };
    modal.style.display='flex';
  }

  function renderPager(id, type, total){
    const max = Math.ceil(total/step);
    if(max <= 1) { document.getElementById(id).innerHTML = ""; return; }
    document.getElementById(id).innerHTML = `
      <button class="page-btn" ${pages[type]===0?'disabled':''} onclick="pages['${type}']--; refresh()" style="background:white; border:1px solid #f1f5f9; padding:8px 16px; border-radius:10px; cursor:pointer;">‚Üê</button>
      <span style="color:var(--text-muted); font-size: 0.75rem;">Page ${pages[type]+1} of ${max}</span>
      <button class="page-btn" ${pages[type]>=max-1?'disabled':''} onclick="pages['${type}']++; refresh()" style="background:white; border:1px solid #f1f5f9; padding:8px 16px; border-radius:10px; cursor:pointer;">‚Üí</button>
    `;
  }

  function refresh(){
    const tCash = wallets.reduce((s,w)=>s+w.balance,0);
    const tBills = bills.reduce((s,b)=>s+b.amount,0);
    const tDebts = debts.reduce((s,d)=>s+d.amount,0);
    
    document.getElementById('mainTotal').innerText = format(tCash);
    document.getElementById('billForecast').innerText = format(tCash - tBills);
    document.getElementById('totalBillsOnly').innerText = format(tBills);
    document.getElementById('debtForecast').innerText = format(tCash - tDebts);
    document.getElementById('totalDebtsOnly').innerText = format(tDebts);
    document.getElementById('gWalletSelect').innerHTML = wallets.map((w,i)=>`<option value="${i}">${w.name} (‚Ç±${format(w.balance)})</option>`).join('') || '<option value="">No Wallet</option>';

    document.getElementById('walletGrid').innerHTML = wallets.map((w,i)=>`
      <div class="wallet-card">
        <b>${w.name}</b><span>‚Ç±${format(w.balance)}</span>
        <div class="action-btns"><button class="edit-btn" onclick="openEdit('wallets',${i})">Edit</button><button class="del-btn" onclick="confirmDelete('wallets',${i})">üóë</button></div>
      </div>`).join('');

    const bStart = pages.bills * step;
    document.getElementById('billList').innerHTML = bills.slice(bStart, bStart + step).map((b,i)=>`
      <div class="list-item">
        <div><b style="font-size: 0.95rem;">${b.name}</b><br><small style="color:var(--text-muted)">‚Ç±${format(b.amount)}</small></div>
        <div style="text-align:right"><button class="pay-btn" onclick="openPayIndividual('bills',${bStart+i})">Pay</button>
        <div class="action-btns" style="margin-top:8px"><button class="edit-btn" onclick="openEdit('bills',${bStart+i})">Edit</button><button class="del-btn" onclick="confirmDelete('bills',${bStart+i})">üóë</button></div></div>
      </div>`).join('');
    renderPager('billPager', 'bills', bills.length);

    const dStart = pages.debts * step;
    document.getElementById('debtList').innerHTML = debts.slice(dStart, dStart + step).map((d,i)=>`
      <div class="list-item">
        <div><b style="font-size: 0.95rem;">${d.name}</b><br><small style="color:var(--text-muted)">‚Ç±${format(d.amount)}</small></div>
        <div style="text-align:right"><button class="pay-btn" onclick="openPayIndividual('debts',${dStart+i})">Pay</button>
        <div class="action-btns" style="margin-top:8px"><button class="edit-btn" onclick="openEdit('debts',${dStart+i})">Edit</button><button class="del-btn" onclick="confirmDelete('debts',${dStart+i})">üóë</button></div></div>
      </div>`).join('');
    renderPager('debtPager', 'debts', debts.length);

    const hReversed = history.slice().reverse();
    const hStart = pages.history * step;
    document.getElementById('historyList').innerHTML = hReversed.slice(hStart, hStart + step).map((h,i)=>`
      <div class="list-item">
        <div><b style="font-size: 0.9rem;">${h.name}</b><br><small style="font-size: 0.7rem; color:var(--text-muted)">${h.wallet} ‚Ä¢ ${h.date} ${h.time || ''}</small></div>
        <div style="text-align:right"><b style="color:var(--danger)">-‚Ç±${format(h.amount)}</b>
        <div class="action-btns" style="margin-top:8px"><button class="edit-btn" onclick="openEdit('history',${history.length-1-(hStart+i)})">Edit</button><button class="del-btn" onclick="confirmDelete('history',${history.length-1-(hStart+i)})">üóë</button></div></div>
      </div>`).join('');
    renderPager('historyPager', 'history', history.length);
  }
  refresh();
</script>
</body>
</html>
